-- DROP any existing objects from previous runs
-- for Oracle only, this section is commented out for reference in case they need to be run manually
-- the other DBMS create scripts can dynamically drop objects instead
-- DROP TABLE concept_set;
-- DROP SEQUENCE concept_set_sequence;
-- DROP TABLE concept_set_item;
-- DROP SEQUENCE concept_set_item_sequence;

CREATE SEQUENCE ${ohdsiSchema}.CONCEPT_SET_NEGATIVE_CONTROLS_SEQUENCE MAXVALUE 9223372036854775807 NOCYCLE;
CREATE TABLE [${ohdsiSchema}].CONCEPT_SET_NEGATIVE_CONTROLS (
    id INTEGER NOT NULL,
    source_id INTEGER NOT NULL,
    concept_set_id INTEGER NOT NULL,
    concept_set_name VARCHAR(255) NOT NULL,
    concept_id INTEGER NOT NULL,
    concept_name VARCHAR(255) NOT NULL,
    domain_id VARCHAR(255) NOT NULL,
    MEDLINE_CT FLOAT NULL,
    MEDLINE_CASE FLOAT NULL,
    MEDLINE_OTHER FLOAT NULL,
    SEMMEDDB_CT_T FLOAT NULL,
    SEMMEDDB_CASE_T FLOAT NULL,
    SEMMEDDB_OTHER_T FLOAT NULL,
    SEMMEDDB_CT_F FLOAT NULL,
    SEMMEDDB_CASE_F FLOAT NULL,
    SEMMEDDB_OTHER_F FLOAT NULL,
    EU_SPC FLOAT NULL,
    SPL_ADR FLOAT NULL,
    AERS FLOAT NULL,
    AERS_PRR FLOAT NULL,
    MEDLINE_CT_SCALED FLOAT NULL,
    MEDLINE_CASE_SCALED FLOAT NULL,
    MEDLINE_OTHER_SCALED FLOAT NULL,
    SEMMEDDB_CT_T_SCALED FLOAT NULL,
    SEMMEDDB_CASE_T_SCALED FLOAT NULL,
    SEMMEDDB_OTHER_T_SCALED FLOAT NULL,
    SEMMEDDB_CT_F_SCALED FLOAT NULL,
    SEMMEDDB_CASE_F_SCALED FLOAT NULL,
    SEMMEDDB_OTHER_F_SCALED FLOAT NULL,
    EU_SPC_SCALED FLOAT NULL,
    SPL_ADR_SCALED FLOAT NULL,
    AERS_SCALED FLOAT NULL,
    AERS_PRR_SCALED FLOAT NULL,
    MEDLINE_CT_BETA FLOAT NULL,
    MEDLINE_CASE_BETA FLOAT NULL,
    MEDLINE_OTHER_BETA FLOAT NULL,
    SEMMEDDB_CT_T_BETA FLOAT NULL,
    SEMMEDDB_CASE_T_BETA FLOAT NULL,
    SEMMEDDB_OTHER_T_BETA FLOAT NULL,
    SEMMEDDB_CT_F_BETA FLOAT NULL,
    SEMMEDDB_CASE_F_BETA FLOAT NULL,
    SEMMEDDB_OTHER_F_BETA FLOAT NULL,
    EU_SPC_BETA FLOAT NULL,
    SPL_ADR_BETA FLOAT NULL,
    AERS_BETA FLOAT NULL,
    AERS_PRR_BETA FLOAT NULL,
    RAW_PREDICTION FLOAT NULL,
    PREDICTION FLOAT NULL
 );

ALTER TABLE [${ohdsiSchema}].CONCEPT_SET_NEGATIVE_CONTROLS ADD (
    CONSTRAINT PK_CONCEPT_SET_NEGATIVE_CONTROLS PRIMARY KEY (ID));

CREATE OR REPLACE TRIGGER CONCEPT_SET_NEGATIVE_CONTROLS_bir
BEFORE INSERT ON [${ohdsiSchema}].CONCEPT_SET_NEGATIVE_CONTROLS
FOR EACH ROW

BEGIN
    SELECT CONCEPT_SET_NEGATIVE_CONTROLS_SEQUENCE.NEXTVAL
    INTO :new.id
    FROM dual;
END;
